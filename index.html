<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>poemBot by evanwill</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>poemBot</h1>
          <h2>printer + pi + python + poems</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/evanwill/poemBot/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/evanwill/poemBot/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/evanwill/poemBot" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a id="poembot" class="anchor" href="#poembot" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>poemBot</h1>

<blockquote>
<p>printer + pi + python + poems. </p>
</blockquote>

<p>Easy to read, carry in your pocket, and share with your friends: poems printed on receipts are fun!</p>

<p>PoemBot is a <a href="https://www.raspberrypi.org/">Raspberry Pi</a> connected to a <a href="https://www.adafruit.com/products/597">thermal receipt printer</a> offering physical prints from a daily poetry website at the touch of a button. It was developed to help promote the <a href="http://poetry.lib.uidaho.edu/">Vandal Poem of the Day</a> project which seeks to bring relevant contemporary poetry to University of Idaho and the broader Idaho community.
In addition to printing poems, poemBot does other fun stuff. It goes to conferences, attends poetry readings, creates contact cards for the library, and prints stuff for special events! </p>

<p>Here is a little video of the earliest prototype: <a href="https://twitter.com/VandalPoem/status/704377485593432065">https://twitter.com/VandalPoem/status/704377485593432065</a> </p>

<p>Originally based on <a href="https://learn.adafruit.com/pi-thermal-printer/overview">Adafruit IoT Printer</a>, poemBot uses a version of the printer library from Adafruit <a href="https://github.com/adafruit/Python-Thermal-Printer/blob/master/Adafruit_Thermal.py">Python-Thermal-Printer</a>.</p>

<p>A full example implementation is available as <code>poemsMain.py</code> using public domain poems. </p>

<h2>
<a id="case-and-wiring" class="anchor" href="#case-and-wiring" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Case and Wiring</h2>

<p>Our physical set up mostly follows <a href="https://learn.adafruit.com/pi-thermal-printer/overview">Adafruit IoT Printer</a>. 
However, to simplify construction and reuse, I replaced the t-cobbler with jumpers soldered to the components, inspired by <a href="https://github.com/simonmonk/squid">simonmonk's Squid</a>. This makes it easy to assemble, modify, and demo.</p>

<p><img src="squid2.JPG" alt="squid button"></p>

<p>I built cases out of 1x6 boards to give the poemBot a solid home.</p>

<p><img src="poemBot3.JPG" alt="poemBot wooden case"></p>

<p>Here's what it looks like inside:</p>

<p><img src="poemBot_inside.JPG" alt="poemBot insides"></p>

<h2>
<a id="example-implementation" class="anchor" href="#example-implementation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example Implementation</h2>

<p>This repository contains a complete example implementation using public domain poems, plus all the original VPOD files used for various purposes (which might not include the data and image files due to copyright). 
The main loop is <code>poemsMain.py</code> which loads poems to print from <code>goldenTreasuryPoems.csv</code>.
I created the poem CSV following a similar method as with VPOD using <a href="https://github.com/OpenRefine/OpenRefine">OpenRefine</a> to parse the <a href="http://www.gutenberg.org/ebooks/19221">HTML text</a> from Project Gutenberg.
Since there is no markup other than <code>&lt;pre&gt;</code> tags, parsing was mostly achieved using regular expressions.
I selected approximately 100 poems less than 20 lines in length. 
The CSV has the columns: <code>number,title,author,poem,book</code>. Number is the number given in the Golden Treasury.  </p>

<blockquote>
<p>THE GOLDEN TREASURY
Of the best Songs and Lyrical Pieces
In the English Language
Selected by Francis Turner Palgrave 
1861
<a href="http://www.gutenberg.org/ebooks/19221">Project Gutenberg EBook #19221</a></p>
</blockquote>

<h2>
<a id="prepare-poems" class="anchor" href="#prepare-poems" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Prepare Poems</h2>

<p>The VPOD printer script loads the poems from a CSV with the columns: <code>VPODdate, title, author, poem, book</code>.
VPODdate is the date the poem appeared as Vandal Poem of the Day. 
The poem column contains the full text of the poem with no markup, only <code>\n</code>. Line indentation is replaced by spaces.
The book column is the title of the book where the poem appears plus the year of publication.</p>

<p>To create this data I exported all VPOD poems from the Wordpress poetry website in XML, with embedded HTML markup. 
I used <a href="https://github.com/OpenRefine/OpenRefine">OpenRefine</a> to parse the XML and transform the data. 
I cleaned up the HTML markup, replacing CSS indentation with spaces and adding <code>\n</code>. </p>

<p>Since the thermal printer is small with 32 normal characters per line, larger poems could take several feet of paper to print. 
I decided to limit the pool of poems based on number of lines and total characters. 
This can be done quickly with OpenRefine by creating new columns based on poem with <code>value.split("\n").length()</code> and <code>length(value)</code>, then adding numeric facets. 
Export the subset of poems data as CSV from OpenRefine. </p>

<p>Edit the CSV with a text editor (not LibreOffice or Excel) to remove the header and check the character encoding to avoid issues with Python and the printer. 
The Adafruit thermal printer only supports the <a href="https://en.wikipedia.org/wiki/Code_page_437">CP 437</a> character set.
The current UTF-8 encoding can generate strange outputs on special characters. 
Convert the encoding to CP437.</p>

<h2>
<a id="set-up" class="anchor" href="#set-up" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Set Up</h2>

<p>The Raspberry Pi needs to be set up to run headless. 
SSH in for set up and testing. 
After testing the Python main loop and poem printing, set it to load on boot by editing rc.local:</p>

<p><code>sudo nano /etc/rc.local</code></p>

<p>Add the terminal command to start the python script before the line "exit 0":</p>

<pre><code>cd /home/pi/poemBot
python poemsMain.py &amp;
</code></pre>

<h2>
<a id="references" class="anchor" href="#references" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>References</h2>

<p>UBC RAD-device, <a href="https://github.com/asistubc/RAD-device">https://github.com/asistubc/RAD-device</a></p>

<p>Little Box of Poems, <a href="http://www.suppertime.co.uk/blogmywiki/2012/12/pi-poems/">http://www.suppertime.co.uk/blogmywiki/2012/12/pi-poems/</a></p>

<p>Adafruit IoT Printer, <a href="https://learn.adafruit.com/pi-thermal-printer/overview">https://learn.adafruit.com/pi-thermal-printer/overview</a></p>
        </section>

        <footer>
          poemBot is maintained by <a href="https://github.com/evanwill">evanwill</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

                  <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-74844011-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

      </div>
    </div>
  </body>
</html>
