<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>poemBot by evanwill</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">poemBot</h1>
      <h2 class="project-tagline">printer + pi + python + poems</h2>
      <a href="https://github.com/evanwill/poemBot" class="btn">View on GitHub</a>
      <a href="https://github.com/evanwill/poemBot/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/evanwill/poemBot/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="poembot" class="anchor" href="#poembot" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>poemBot</h1>

<blockquote>
<p>printer + pi + python + poems. </p>
</blockquote>

<p>Easy to read, carry in your pocket, and share with your friends: poems printed on receipts are fun!</p>

<p><img src="https://github.com/evanwill/poemBot/raw/master/poemBot2.JPG" alt="poemBot2"></p>

<p>PoemBot is a Raspberry Pi connected to a thermal printer offering physical prints from a daily poetry website at the touch of a button. It was developed to help promote the <a href="http://poetry.lib.uidaho.edu/">Vandal Poem of the Day</a> project which seeks to bring relevant contemporary poetry to University of Idaho and the broader Idaho community.
In addition to printing poems, poemBot does other fun stuff. It went to a conference, attended a poetry reading, printed the 4H pledge, and created contact cards for library open houses!</p>

<p>Here is a little video: <a href="https://twitter.com/VandalPoem/status/704377485593432065">https://twitter.com/VandalPoem/status/704377485593432065</a> </p>

<p>Originally based on Adafruit IoT Printer, <a href="https://learn.adafruit.com/pi-thermal-printer/overview">https://learn.adafruit.com/pi-thermal-printer/overview</a></p>

<p>Uses a version of the printer library from Adafruit Python-Thermal-Printer, <a href="https://github.com/adafruit/Python-Thermal-Printer/blob/master/Adafruit_Thermal.py">https://github.com/adafruit/Python-Thermal-Printer/blob/master/Adafruit_Thermal.py</a></p>

<p>A full example implementation is available as <code>poemsMain.py</code> using public domain poems. </p>

<h2>
<a id="prepare-poems" class="anchor" href="#prepare-poems" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Prepare Poems</h2>

<p>The printer script loads the poems from a CSV with the columns: VPODdate, title, author, poem, book.
VPODdate is the date the poem appeared as Poem of the Day. 
The poem column contains the full text of the poem with no markup, only \n. Line indentation is replaced by spaces.
The book column is the title of the book where the poem appears plus the year of publication.</p>

<p>I exported all poems from the Wordpress poetry website in XML, with embedded HTML markup. 
I used <a href="https://github.com/OpenRefine/OpenRefine">OpenRefine</a> to parse the XML and transform the data. 
I cleaned up the HTML markup, replacing CSS indentation with spaces and adding \n. </p>

<p>Since the thermal printer is small with 32 normal characters per line, larger poems could take several feet of paper to print. 
I decided to limit the pool of poems based on number of lines and total characters. 
This can be done quickly with OpenRefine by creating new columns based on poem with <code>value.split("\n").length()</code> and <code>length(value)</code>, then adding numeric facets. 
Export the subset of poems data as CSV from OpenRefine. </p>

<p>Edit the CSV with a text editor (not LibreOffice or Excel) to remove the header and check the character encoding to avoid issues with Python and the printer. 
The adafruit thermal printer only supports the <a href="https://en.wikipedia.org/wiki/Code_page_437">CP 437</a> character set.
The current UTF-8 encoding can generate strange outputs on special characters. 
Convert the encoding to CP437.</p>

<h2>
<a id="case-and-wiring" class="anchor" href="#case-and-wiring" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Case and Wiring</h2>

<p>Our physical set up mostly follows <a href="https://learn.adafruit.com/pi-thermal-printer/overview">Adafruit IoT Printer</a>. 
However, to simplify construction and reuse, I replaced the t-cobbler with jumpers soldered to the components, inspired by <a href="https://github.com/simonmonk/squid">simonmonk's Squid</a>.
I built cases out of 1x6 boards to give the poemBot a solid home.</p>

<h2>
<a id="example-implementation" class="anchor" href="#example-implementation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example Implementation</h2>

<p>This repository contains the original VPOD files, plus a complete example implementation using public domain poems. 
The main loop is <code>poemsMain.py</code> which loads poems to print from <code>goldenTreasuryPoems.csv</code>.
I created the poem CSV following a similar method as with VPOD using <a href="https://github.com/OpenRefine/OpenRefine">OpenRefine</a> to parse the <a href="http://www.gutenberg.org/ebooks/19221">HTML text</a> from Project Gutenberg.
Since there is no markup other than <code>&lt;pre&gt;</code> tags, parsing was mostly achieved using regular expressions.
I selected approximately 100 poems less than 20 lines in length. 
The CSV has the columns: number,title,author,poem,book. Number is the number given in the Golden Treasury.  </p>

<blockquote>
<p>THE GOLDEN TREASURY
Of the best Songs and Lyrical Pieces
In the English Language
Selected by Francis Turner Palgrave 
1861
<a href="http://www.gutenberg.org/ebooks/19221">Project Gutenberg EBook #19221</a></p>
</blockquote>

<h2>
<a id="set-up" class="anchor" href="#set-up" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Set Up</h2>

<p>The Raspberry Pi needs to be set up to run headless. 
SSH in for set up and testing. 
After testing the Python main loop and poem printing, set it to load on boot by editing rc.local:</p>

<p><code>sudo nano /etc/rc.local</code></p>

<p>Add the terminal command to start the python script before the line "exit 0":</p>

<pre><code>cd /home/pi/poemBot
python poemsMain.py &amp;
</code></pre>

<h2>
<a id="references" class="anchor" href="#references" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>References</h2>

<p>UBC RAD-device, <a href="https://github.com/asistubc/RAD-device">https://github.com/asistubc/RAD-device</a></p>

<p>Little Box of Poems, <a href="http://www.suppertime.co.uk/blogmywiki/2012/12/pi-poems/">http://www.suppertime.co.uk/blogmywiki/2012/12/pi-poems/</a></p>

<p>Adafruit IoT Printer, <a href="https://learn.adafruit.com/pi-thermal-printer/overview">https://learn.adafruit.com/pi-thermal-printer/overview</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/evanwill/poemBot">poemBot</a> is maintained by <a href="https://github.com/evanwill">evanwill</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-74844011-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
